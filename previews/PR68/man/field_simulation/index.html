<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Field Simulation · LegendGeSim</title><meta name="title" content="Field Simulation · LegendGeSim"/><meta property="og:title" content="Field Simulation · LegendGeSim"/><meta property="twitter:title" content="Field Simulation · LegendGeSim"/><meta name="description" content="Documentation for LegendGeSim."/><meta property="og:description" content="Documentation for LegendGeSim."/><meta property="twitter:description" content="Documentation for LegendGeSim."/><meta property="og:url" content="https://legend-exp.github.io/LegendGeSim.jl/stable/man/field_simulation/"/><meta property="twitter:url" content="https://legend-exp.github.io/LegendGeSim.jl/stable/man/field_simulation/"/><link rel="canonical" href="https://legend-exp.github.io/LegendGeSim.jl/stable/man/field_simulation/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">LegendGeSim</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../LegendGeSim/">The LEGEND Germanium Simulation Chain</a></li><li class="is-active"><a class="tocitem" href>Field Simulation</a><ul class="internal"><li><a class="tocitem" href="#Example"><span>Example</span></a></li><li><a class="tocitem" href="#1.-LEGEND-detector-metadata"><span>1. LEGEND detector metadata</span></a></li><li><a class="tocitem" href="#2.-Environment-settings"><span>2. Environment settings</span></a></li><li><a class="tocitem" href="#3.-Simulation-settings"><span>3. Simulation settings</span></a></li></ul></li><li><a class="tocitem" href="../ideal_pulse_simulation/">Ideal Pulse Simulation</a></li><li><a class="tocitem" href="../realistic_waveform_simulation/">Realistic Waveform Simulation</a></li></ul></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../../tutorials/detector_geometry/">Detector Geometry</a></li><li><a class="tocitem" href="../../tutorials/simulate_fields/">Simulate Fields</a></li><li><a class="tocitem" href="../../tutorials/simulate_ideal_pulses/">Simulate Ideal Pulses</a></li><li><a class="tocitem" href="../../tutorials/simulate_realistic_waveforms/">Simulate Realistic Waveforms</a></li></ul></li><li><a class="tocitem" href="../../api/">API</a></li><li><a class="tocitem" href="../../LICENSE/">LICENSE</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>Field Simulation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Field Simulation</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/legend-exp/LegendGeSim.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/legend-exp/LegendGeSim.jl/blob/main/docs/src/man/field_simulation.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Field-Simulation"><a class="docs-heading-anchor" href="#Field-Simulation">Field Simulation</a><a id="Field-Simulation-1"></a><a class="docs-heading-anchor-permalink" href="#Field-Simulation" title="Permalink"></a></h1><p>As inputs to field simulation you should provide</p><ol><li><p>LEGEND detector metadata</p></li><li><p>Environment settings</p></li><li><p>Simulation settings</p></li></ol><h2 id="Example"><a class="docs-heading-anchor" href="#Example">Example</a><a id="Example-1"></a><a class="docs-heading-anchor-permalink" href="#Example" title="Permalink"></a></h2><pre><code class="language-julia hljs">detector_metadata_filename = &quot;path/to/legend-detectors/germanium/diodes/V04545A.json&quot;

environment_settings = Dict(
    &quot;crystal_temperature_in_K&quot; =&gt; 77, 
    &quot;medium&quot; =&gt; &quot;vacuum&quot;, 
    &quot;dl&quot; =&gt; &quot;vendor&quot; # optional, default 0
    &quot;operating_voltage_in_V&quot; =&gt; 5000, # optional, default recV from metadata
)

simulation_settings = Dict(
    &quot;method&quot; =&gt; &quot;SSD&quot;,
    &quot;cached_name&quot; =&gt; &quot;test&quot;,
    &quot;crystal_metadata_path&quot; =&gt; &quot;path/to/legend-detectors/germanium/crystals&quot;
)

sim = LegendGeSim.simulate_fields(detector_metadata_filename, environment_settings, simulation_settings; overwrite=true)</code></pre><p>Provide an optional argument <code>overwrite</code> to overwrite an existing file with the same <code>cached_name</code>. Default: <code>false</code></p><p>In case of SSD as method, the output of <code>simulate_fields()</code> is a <code>Simulation</code> object from <code>SolidSateDetectors.jl</code>. Among other things, it contains a <code>SolidStateDetector</code> object under <code>sim.detector</code>. See the short tutorial on how to <a href="../../tutorials/detector_geometry/#Visualize-Detector-Geometry">Visualize Detector Geometry</a> using this object.</p><p>In case of siggen as method, the output of <code>simulate_fields()</code> is a <code>SigGenSetup</code> object from <code>MJDSigGen.jl</code> containing information needed for the siggen simulation. It is possible to extract the electric and weighting potential from this object and plot it (see tutotorial <a href="../../tutorials/simulate_fields/#Simulate-Fields">Simulate Fields</a>).</p><h2 id="1.-LEGEND-detector-metadata"><a class="docs-heading-anchor" href="#1.-LEGEND-detector-metadata">1. LEGEND detector metadata</a><a id="1.-LEGEND-detector-metadata-1"></a><a class="docs-heading-anchor-permalink" href="#1.-LEGEND-detector-metadata" title="Permalink"></a></h2><p>To obtain JSONs for all LEGEND detectors you can clone the repository <code>legend-detectors</code>. The JSONs can be found under <code>germanium/diodes</code>. You may also create your custom detector JSON file as long as it follows the LEGEND detector metadata format (see README in <code>diodes/</code>).</p><h2 id="2.-Environment-settings"><a class="docs-heading-anchor" href="#2.-Environment-settings">2. Environment settings</a><a id="2.-Environment-settings-1"></a><a class="docs-heading-anchor-permalink" href="#2.-Environment-settings" title="Permalink"></a></h2><p>Environment settings contain:</p><ul><li><p><code>&quot;crystal_temperature_in_K&quot;</code>: crystal temperature in units of Kelvin e.g. 77 for liquid nitrogen, 90 for LAr</p></li><li><p><code>&quot;medium&quot;</code>: <code>&quot;vacuum&quot;</code> or <code>&quot;LAr&quot;</code> (note: the LAr option has actually never been tested yet)</p></li><li><p><code>&quot;operating_voltage_in_V&quot;</code>: bias voltage at the n+ contact in units of Volts</p><p>If you do not provide this field in the environment settings, the value from <code>characterization.l200_site.recommended_voltage_in_V</code> in detector metadata JSON will be taken.</p></li><li><p><code>&quot;dl&quot;</code>: dead layer (DL) thickness in mm.</p><p>This is not really part of &quot;environment&quot; but is added as a temporary quickfix for now to be able to study DL effects. In the future might be moved to simulation settings (see below).</p><p>Provide a value e.g. <code>&quot;dl&quot; =&gt; 1.2</code>. If you do not provide this setting at all, default <code>0</code> will be taken</p><p>Providing <code>&quot;dl&quot; =&gt; &quot;vendor&quot;</code> means the value from <code>characterization.manufacturer.dl_thickness_in_mm</code> in detector metadata JSON file will be taken.</p></li></ul><h2 id="3.-Simulation-settings"><a class="docs-heading-anchor" href="#3.-Simulation-settings">3. Simulation settings</a><a id="3.-Simulation-settings-1"></a><a class="docs-heading-anchor-permalink" href="#3.-Simulation-settings" title="Permalink"></a></h2><p>Simulation settings contain:</p><ul><li><p><code>&quot;method&quot;</code>: <code>&quot;SSD&quot;</code> (or <code>&quot;ssd&quot;</code>) or <code>&quot;siggen&quot;</code> (or <code>&quot;fieldgen&quot;</code>)</p><p>Based on the given method, <code>LegendGeSim</code> will automatically construct configurations for either method based on the detector metadata, environment, and simulation settings</p></li><li><p><code>&quot;cached_name&quot;</code>: if provided, your simulation will be cached in a file for future uses in a directory <code>cache/</code> (will be created if not present)</p><p>Format:</p><ul><li><p><code>cache/&lt;detector name&gt;_&lt;cached_name&gt;_SSD.h5f</code> file for SSD</p></li><li><p><code>cache/&lt;detector_name&gt;_&lt;cached_name&gt;_fieldgen_WP.dat</code> and <code>*_EV.dat</code> files for siggen.</p><p>In case of siggen, a siggen config named <code>cache/&lt;detector_name&gt;_&lt;cached_name&gt;_siggen_config.txt</code> will also be saved (generated based on given settings and geometry).</p></li></ul><p>The detector name is taken from the detector metadata JSON <code>&quot;name&quot;</code> field.</p><p>If cached name is not provided (or <code>&quot;&quot;</code> is provided), the simulation will not be cached (for siggen will create a temporary config file).</p><p>It may be convenient to compose the <code>cached_name</code> in the simulation settings based on environment settings, varying detector geometry etc.</p></li><li><p><code>&quot;crystal_metadata_path&quot;</code>: path to folder with crystal metadata JSONs.</p><p>To obtain JSONs for LEGEND crystals you can clone the repository <code>legend-detectors</code>. The JSONs can be found under <code>germanium/crystals</code>. You may also create your custom crystal JSON file as long as it follows the LEGEND crystal metadata format (see README in <code>crystals/</code>).</p><p>The crystal corresponding to your detector will be chosen from the given path based on the <code>&quot;name&quot;</code> field in the detector JSON. E.g. if your detector <code>&quot;name&quot;</code> field states <code>&quot;V04545A&quot;</code>, <code>LegendGeSim</code> will be looking for a file <code>&quot;V04545.json&quot;</code>.</p><p>The impurity profile will be constructed by fitting the impurity measurement points in the JSON using David Radford&#39;s function <code>a + b*z + c*exp((L - z)/tau)</code> (in crystal axis coordinates, later converted to detector axis). In case of SSD, the profile will be provided to the simulation internally, while for siggen, an input file will be created in siggen format (e.g. <code>&quot;cache/V04545.dat&quot;</code>). In either case, the position of the detector in the crystal is determined by the offset field contained in the crystal metadata.</p><p>For SSD, if no crystal metadata path is provided (or <code>&quot;&quot;</code> is provided), a dummy constant impurity of 10⁹ e/cm³ will be used.</p></li></ul><p>Alternative options for <code>siggen</code>: rather than providing a path to the crystal metadata folder and implementing impurity profile as described above, you may instead provide two inputs as is traditionally done when running siggen:</p><ul><li><p><code>&quot;impurity_profile&quot;</code>: path to a <code>.dat</code> file with the impurity profile (unformatted stream of Float32 of impurity values in units of 10¹⁰ e/cm³ with a step of 1 mm from tail end)</p></li><li><p><code>&quot;offset_in_mm&quot;</code>: offset of the detector from tail end in mm</p></li></ul><p>If neither <code>&quot;crystal_metadata_path&quot;</code> not these settings are provided for siggen, a dummy constant impurity will be used as described above.</p><p>Optional settings for <code>siggen</code>:</p><ul><li><p><code>&quot;fieldgen_config&quot;</code>: path to a siggen format config with &quot;extra&quot; settings e.g. crystal grid. Default <code>examples/configs/fieldgen_settings.txt</code> (in <code>LegendGeSim</code>). Note: in case of no crystal impurity profile input, a dummy constant impurity that is used is written in this file. In the future, all other optional fieldgen settings will be incorporated into the simulation settings input via <code>LegendGeSim</code>.</p></li><li><p><code>&quot;drift_vel&quot;</code>: path to siggen format drift velocity file. Default <code>examples/configs/drift_vel_tcorr.tab</code> (in <code>LegendGeSim</code>)</p></li></ul><p><strong>WARNING</strong></p><p>The implementation here is kind of janky, and if you want to read from a cached file, in theory you should only need to provide the cached name. However, for now it will also ask you to provide the other non-optional fields as well, and even worse - it will print out those settings first, and only then figure out that there&#39;s a cached file.</p><p>This will of course be fixed in the future to not require those inputs, and possibly issue a warning if a cache file exists but settings are provided etc.</p><p>However, even after that, if you provide certain inputs like temperature and crystal metadata path and a cached name that already exists, that cached file will be read even if the simulation there does no correspond to your other inputs, unless you provide <code>overwrite=true</code> to overwrite that file. For now at least, it is the user&#39;s job to remember which settings were used for the cached simulation.</p><p><strong>User suggestions are very welcome on how to manage this better</strong>    </p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../LegendGeSim/">« The LEGEND Germanium Simulation Chain</a><a class="docs-footer-nextpage" href="../ideal_pulse_simulation/">Ideal Pulse Simulation »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Wednesday 20 November 2024 15:15">Wednesday 20 November 2024</span>. Using Julia version 1.11.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
